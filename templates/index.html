<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Tic-Tac-Toe AI</title>
<style>
:root {
  --primary: #4A6CF7;
  --primary-dark: #3A56E0;
  --secondary: #FF6B6B;
  --secondary-dark: #E94B35;
  --accent: #9C7BFF;
  --text-primary: #2C3E50;
  --text-secondary: #657786;
  --bg-light: #F8FAFF;
  --bg-glass: rgba(255, 255, 255, 0.85);
  --border-light: rgba(255, 255, 255, 0.5);
  --shadow-medium: 0 15px 40px rgba(0,0,0,0.1);
  --transition: all 0.3s ease;
}

*{box-sizing:border-box;margin:0;padding:0;}
body {
  font-family: 'Nunito', sans-serif;
  background: linear-gradient(120deg,#f5f7fa 0%,#dde3ff 100%);
  height:100vh; display:flex; align-items:center; justify-content:center;
  overflow:hidden;
}
.app-container{flex:1;display:flex;flex-direction:column;align-items:center;justify-content:space-between;max-width:500px;}
header{text-align:center;}
h1{
  font-size:2.5rem;font-weight:900;
  background:linear-gradient(135deg,var(--primary) 0%,var(--accent) 100%);
  -webkit-background-clip:text;-webkit-text-fill-color:transparent;
}
.subtitle{color:var(--text-secondary);margin-top:0.4rem;font-size:1rem;}

.game-container{text-align:center;}
#status{
  margin:1rem auto;padding:0.8rem 1rem;min-height:50px;
  border-radius:12px;background:var(--bg-glass);backdrop-filter:blur(12px);
  box-shadow:var(--shadow-medium); font-weight:600;
}
#container{background:var(--bg-glass);backdrop-filter:blur(12px);padding:1.2rem;border-radius:20px;box-shadow:var(--shadow-medium);}
#board{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;aspect-ratio:1;width:270px;}
.cell{
  background:#fff;border:none;border-radius:12px;cursor:pointer;
  font-size:2.5rem;font-weight:800;color:var(--primary);
  display:flex;align-items:center;justify-content:center;
  box-shadow:0 5px 12px rgba(0,0,0,0.08);transition:var(--transition);
}
.cell:hover{transform:translateY(-3px) scale(1.05);}
.cell.x{color:var(--primary);}
.cell.o{color:var(--secondary);}
.cell.win-human{background:#ebf2ff;color:var(--primary-dark);}
.cell.win-ai{background:#ffeaea;color:var(--secondary-dark);}
.cell.animate{animation:pop 0.3s;}
@keyframes pop{0%{transform:scale(0.7);}100%{transform:scale(1);}}

.controls{margin-top:1rem;display:flex;gap:0.8rem;justify-content:center;flex-wrap:wrap;}
.btn{
  padding:0.7rem 1.5rem; border-radius:10px; font-weight:700; border:none; cursor:pointer;
  transition:var(--transition);
}
.btn.primary{background:linear-gradient(135deg,var(--primary),var(--primary-dark));color:#fff;}
.btn.primary:hover:not(:disabled){transform:translateY(-3px);}
.btn.secondary{background:#f0f2ff;color:var(--text-primary);}
.btn.secondary:hover:not(:disabled){background:#e6e9ff;}
.btn.undo {
  background: linear-gradient(135deg, #9C7BFF, #6E57FF);
  color: white;
  font-weight: 700;
  padding: 0.7rem 1.6rem;
  border-radius: 10px;
  cursor: pointer;
  transition: var(--transition);
}
.btn.undo:disabled {
  cursor: not-allowed;
  opacity: 0.5;
}
.btn.undo:hover:not(:disabled) {
  transform: translateY(-3px);
}

/* Footer */
footer{
  text-align:center;margin:1rem 0; font-size:0.85rem; color:var(--text-secondary);
  background:var(--bg-glass);padding:0.8rem 1rem;border-radius:12px;box-shadow:var(--shadow-medium);
}
footer span{font-weight:700;color:var(--primary);}
footer a{color:var(--primary);text-decoration:none;margin:0 0.3rem;transition:var(--transition);}
footer a:hover{color:var(--primary-dark);}

.confetti{position:absolute;width:10px;height:10px;border-radius:50%;animation:fall 4s linear forwards;}
@keyframes fall{0%{transform:translateY(-100px);}100%{transform:translateY(100vh);opacity:0;}}

/* Modal */
.modal-bg{
  position:fixed;top:0;left:0;width:100%;height:100%;
  background:rgba(0,0,0,0.5);display:flex;align-items:center;justify-content:center;
  opacity:0;pointer-events:none;transition:0.3s;
}
.modal-bg.active{opacity:1;pointer-events:auto;}
.modal{
  background:var(--bg-glass);backdrop-filter:blur(12px);padding:1.5rem 2rem;border-radius:18px;
  box-shadow:var(--shadow-medium);max-width:320px;text-align:left;position:relative;
}
.modal h2{margin-bottom:1rem;font-size:1.4rem;color:var(--primary);display:flex;align-items:center;}
.modal p{margin-bottom:0.6rem;line-height:1.5;}
.modal .close-btn{
  position:absolute;top:10px;right:10px;background:none;border:none;font-size:1.4rem;cursor:pointer;
}
</style>
</head>
<body>
<div class="app-container">
  <header>
    <h1>üéÆ Tic-Tac-Toe vs ü§ñ</h1>
    <div class="subtitle">Can you outsmart the algorithm?</div>
  </header>
  
  <div class="game-container">
    <div id="status">Your turn! Place your X</div>
    <div id="container"><div id="board"></div></div>
    <div class="controls">
      <button class="btn primary" onclick="restartGame()">Restart Game</button>
      <button class="btn undo" onclick="undoMove()" id="undoBtn" disabled>Undo</button>
      <button class="btn secondary" onclick="toggleModal(true)">How to Play</button>
    </div>
  </div>

  <footer>
    Built with ‚òïÔ∏è, sunshine, and grit by <span>Kishlay</span><br>
    <a href="https://github.com/innovatewithkishlay/Tic-Tac-Toe-AI" target="_blank">GitHub</a> |
    <a href="https://kishlaykumar.onrender.com/" target="_blank">Portfolio</a>
  </footer>
</div>

<!-- MODAL -->
<div class="modal-bg" id="modal-bg">
  <div class="modal">
    <button class="close-btn" onclick="toggleModal(false)">‚úñ</button>
    <h2>üìú How to Play</h2>
    <p>‚úÖ You are <strong style="color:var(--primary)">X</strong>, AI is <strong style="color:var(--secondary)">O</strong></p>
    <p>üéØ Take turns placing your marks.</p>
    <p>üèÜ First to connect 3 in a row wins!</p>
    <p>üîÑ Use "Restart" anytime for a new game.</p>
  </div>
</div>

<script>
(() => {
  let board = Array(9).fill(' ');
  let gameOver = false, winningCombo = [];
  let moveHistory = []; // Store history of board states before player moves
  const boardDiv = document.getElementById("board");
  const statusDiv = document.getElementById("status");
  const undoBtn = document.getElementById("undoBtn");

  function createBoard() {
    boardDiv.innerHTML = '';
    for (let i = 0; i < 9; i++) {
      const b = document.createElement("button");
      b.className = "cell";
      b.onclick = () => handleMove(i);
      boardDiv.appendChild(b);
    }
  }

  function renderBoard(msg = "") {
    board.forEach((val, i) => {
      const cell = boardDiv.children[i];
      cell.textContent = val === ' ' ? "" : val;
      cell.disabled = val !== ' ' || gameOver;
      cell.className = "cell";
      if (val === 'X') cell.classList.add("x");
      if (val === 'O') cell.classList.add("o");
      if (winningCombo.includes(i)) {
        cell.classList.add(msg.includes("AI") ? "win-ai" : "win-human");
      }
    });
    // Enable undo only if game not over and there is history
    undoBtn.disabled = gameOver || moveHistory.length === 0;
  }

  async function handleMove(i) {
    if (gameOver || board[i] !== ' ') return;
    
    // Save current state before player move for undo
    moveHistory.push([...board]);

    // Player move
    board[i] = 'X';
    renderBoard();
    if (checkWin('X')) return endGame("You win! üéâ");
    if (isDraw()) return endGame("It's a draw ü§ù");
    
    statusDiv.textContent = "AI is thinking...";
    await new Promise(r => setTimeout(r, 600));

    // AI move
    const ai = getAIMove(); 
    board[ai] = 'O';
    renderBoard();
    if (checkWin('O')) return endGame("AI wins! ü§ñ");
    if (isDraw()) return endGame("It's a draw ü§ù");

    statusDiv.textContent = "Your turn! Place your X";
    // Undo available now
    undoBtn.disabled = false;
  }

  function undoMove() {
    if (moveHistory.length === 0 || gameOver) return;

    let prevBoard = moveHistory.pop(); // revert to previous state before player move
    board = [...prevBoard];
    winningCombo = [];
    gameOver = false;
    statusDiv.textContent = "Your turn! Place your X";
    renderBoard();
    undoBtn.disabled = moveHistory.length === 0;
  }

  function getAIMove() {
    for (let i = 0; i < 9; i++) {
      if (board[i] === ' ') {
        board[i] = 'O';
        if (checkWin('O')) {
          board[i] = ' ';
          return i;
        }
        board[i] = ' ';
      }
    }
    for (let i = 0; i < 9; i++) {
      if (board[i] === ' ') {
        board[i] = 'X';
        if (checkWin('X')) {
          board[i] = ' ';
          return i;
        }
        board[i] = ' ';
      }
    }
    if (board[4] === ' ') return 4;
    const corners = [0, 2, 6, 8].filter(i => board[i] === ' ');
    if (corners.length) return corners[Math.floor(Math.random() * corners.length)];
    const sides = [1, 3, 5, 7].filter(i => board[i] === ' ');
    if (sides.length) return sides[Math.floor(Math.random() * sides.length)];
    return board.findIndex(v => v === ' ');
  }

  function checkWin(p) {
    const lines = [
      [0, 1, 2], [3, 4, 5], [6, 7, 8], // rows
      [0, 3, 6], [1, 4, 7], [2, 5, 8], // cols
      [0, 4, 8], [2, 4, 6]             // diagonals
    ];
    return lines.some(([a, b, c]) => {
      if (board[a] === p && board[b] === p && board[c] === p) {
        winningCombo = [a, b, c];
        return true;
      }
      return false;
    });
  }

  function isDraw() {
    return board.every(x => x !== ' ');
  }

  function endGame(msg) {
    gameOver = true;
    statusDiv.textContent = msg;
    renderBoard(msg);
    if (msg.includes("You win")) confettiBlast();
    undoBtn.disabled = true;
  }

  function confettiBlast() {
    const colors = ['#4A6CF7', '#FF6B6B', '#9C7BFF'];
    for (let i = 0; i < 50; i++) {
      const c = document.createElement("div");
      c.className = "confetti";
      c.style.left = Math.random() * 100 + "vw";
      c.style.background = colors[Math.floor(Math.random() * colors.length)];
      document.body.appendChild(c);
      setTimeout(() => c.remove(), 4000);
    }
  }

  window.restartGame = () => {
    board = Array(9).fill(' ');
    gameOver = false;
    winningCombo = [];
    moveHistory = [];
    statusDiv.textContent = "Your turn! Place your X";
    undoBtn.disabled = true;
    createBoard();
  };

  window.toggleModal = (show) => {
    document.getElementById("modal-bg").classList.toggle("active", show);
  };

  window.undoMove = undoMove;

  createBoard();
})();
</script>
</body>
</html>
